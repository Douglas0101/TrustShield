 Compreendi. A análise do log de erro mais recente, name 'MLflowObserver' is not defined, indica que a remoção da classe MLflowObserver não foi acompanhada pela remoção da sua instanciação no código.

  No entanto, este erro é um sintoma de um problema mais profundo e recorrente relacionado a uma condição de corrida (race condition) na forma como o modelo está sendo registrado no MLflow. Para resolver a
  causa raiz e evitar futuros erros, vou implementar uma correção mais robusta e definitiva.

  Plano de Correção:

   1. Refatoração do Registro no MLflow: Vou remover completamente o padrão de design Observer para o registro no MLflow, que se mostrou instável. Em vez disso, vou integrar a lógica de registro do modelo e
      seus artefatos (como o scaler) diretamente na função de treinamento principal (_train_and_log_model), utilizando as funções padrão do MLflow (mlflow.sklearn.log_model). Isso garante que o modelo e seus
      artefatos sejam salvos e registrados de forma síncrona e atômica, eliminando a condição de corrida.
   2. Remoção de Código Legado: O método _save_artifact, que salvava o modelo manualmente, se tornará obsoleto com a nova abordagem e será removido.

  Esta abordagem é mais alinhada com as práticas recomendadas do MLflow e garantirá a estabilidade do pipeline.

  Vou começar aplicando a refatoração no método _train_and_log_model.
 ╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
 │ ✔  Edit src/models/train_fraud_model.py:     def _train_and_log_model(s... =>     def _train_and_log_model(s...                                                                                     │
 │                                                                                                                                                                                                     │
 │    342   })                                                                                                                                                                                         │
 │    343   strategy = ModelTrainerFactory.create_strategy(model_type, self.config)                                                                                                                    │
 │    344                                                                                                                                                                                              │
 │    345 - # ATUALIZAÇÃO: Recebe o modelo E o scaler da estratégia.                                                                                                                                   │
 │    345   train_start = time.time()                                                                                                                                                                  │
 │    346   model, scaler = strategy.train(X_train)                                                                                                                                                    │
 │    347   training_time = time.time() - train_start                                                                                                                                                  │
 │    348   self.notify(TrainingEvent.TRAINING_COMPLETE, {"model_type": model_type, "training_time": training_time})                                                                                   │
 │    349                                                                                                                                                                                              │
 │    351 - # ATUALIZAÇÃO: Passa o scaler para a validação.                                                                                                                                            │
 │    350   metrics = strategy.validate(model, scaler, X_test)                                                                                                                                         │
 │    351   metrics.training_time = training_time                                                                                                                                                      │
 │    352   self.notify(TrainingEvent.MODEL_VALIDATED, {"metrics": metrics})                                                                                                                           │
 │    353                                                                                                                                                                                              │
 │    356 - # ATUALIZAÇÃO: Salva o artefato completo.                                                                                                                                                  │
 │    357 - model_path = self._save_artifact(model, scaler, model_type)                                                                                                                                │
 │    358 - self.notify(TrainingEvent.MODEL_SAVED, {"model_path": model_path})                                                                                                                         │
 │    354 + timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')                                                                                                                                       │
 │    355 + with mlflow.start_run(run_name=f"{model_type.value}_{timestamp}") as run:                                                                                                                  │
 │    356 +     run_id = run.info.run_id                                                                                                                                                               │
 │    357 +     self.notify(TrainingEvent.MODEL_SAVED, {"model_path": f"runs:/{run_id}/model"})                                                                                                        │
 │    358                                                                                                                                                                                              │
 │    360 - with mlflow.start_run(run_name=f"{model_type.value}_{datetime.now().strftime('%Y%m%d-%H%M%S')}") as run:                                                                                   │
 │    359       mlflow.log_params(params)                                                                                                                                                              │
 │    360       mlflow.log_metrics(metrics.to_dict())                                                                                                                                                  │
 │    363 -     mlflow.log_artifact(model_path, artifact_path="model_artifact")                                                                                                                        │
 │    364 -     mlflow.register_model(                                                                                                                                                                 │
 │    365 -         model_uri=f"runs:/{run.info.run_id}/model_artifact",                                                                                                                               │
 │    361 +                                                                                                                                                                                            │
 │    362 +     # Log scaler as a separate artifact                                                                                                                                                    │
 │    363 +     scaler_path = "scaler.joblib"                                                                                                                                                          │
 │    364 +     joblib.dump(scaler, scaler_path)                                                                                                                                                       │
 │    365 +     mlflow.log_artifact(scaler_path, artifact_path="scaler")                                                                                                                               │
 │    366 +                                                                                                                                                                                            │
 │    367 +     # Log the model using the sklearn flavor                                                                                                                                               │
 │    368 +     mlflow.sklearn.log_model(sk_model=model, artifact_path="model")                                                                                                                        │
 │    369 +                                                                                                                                                                                            │
 │    370 +     # Register the logged model                                                                                                                                                            │
 │    371 +     model_uri = f"runs:/{run_id}/model"                                                                                                                                                    │
 │    372 +     registered_model = mlflow.register_model(                                                                                                                                              │
 │    373 +         model_uri=model_uri,                                                                                                                                                               │
 │    374           name=f"TrustShield-{model_type.value}"                                                                                                                                             │
 │    375       )                                                                                                                                                                                      │
 │    368 -                                                                                                                                                                                            │
 │    ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════  │
 │    376       self.notify(TrainingEvent.MLFLOW_LOGGING_COMPLETE, {                                                                                                                                   │
 │    370 -     "model_type": model_type, "model_path": model_path                                                                                                                                     │
 │    ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════  │
 │    377 +         "model_type": model_type, "model_path": model_uri, "model_version": registered_model.version                                                                                       │
 │    378       })                                                                                                                                                                                     │
 │    379   gc.collect()                                                                                                                                                                               │
 │    380                                                                                                                                                                                              │
 ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ A refatoração do método _train_and_log_model foi concluída. Agora, vou remover o método _save_artifact, que se tornou obsoleto.
 ╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
 │ ✔  Edit Model did not provide valid parameters for edit tool                                                                                                                                        │
 │                                                                                                                                                                                                     │
 │    378               })                                                                                                                                                                             │
 │    379           gc.collect()                                                                                                                                                                       │
 │    380                                                                                                                                                                                              │
 │    381 -     # ATUALIZAÇÃO: O método agora salva um dicionário.                                                                                                                                     │
 │    382 -     def _save_artifact(self, model: Any, scaler: Any, model_type: ModelType) -> Path:                                                                                                      │
 │    383 -         timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')                                                                                                                               │
 │    384 -         model_name = f"{model_type.value}_{timestamp}.joblib"                                                                                                                              │
 │    385 -         model_path = self.project_root / 'outputs' / 'models' / model_name                                                                                                                 │
 │    386 -         model_path.parent.mkdir(parents=True, exist_ok=True)                                                                                                                               │
 │    381                                                                                                                                                                                              │
 │    ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════  │
 │    388 -         artifacts = {                                                                                                                                                                      │
 │    389 -             'model': model,                                                                                                                                                                │
 │    390 -             'scaler': scaler,                                                                                                                                                              │
 │    391 -             'training_timestamp': datetime.now().isoformat()                                                                                                                               │
 │    392 -         }                                                                                                                                                                                  │
 │    382                                                                                                                                                                                              │
 │    ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════  │
 │    394 -         joblib.dump(artifacts, model_path, compress=3)                                                                                                                                     │
 │    395 -         return model_path                                                                                                                                                                  │
 │    383                                                                                                                                                                                              │
 │    ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════  │
 │    397 -                                                                                                                                                                                            │
 │    384   # =====================================================================================                                                                                                    │
 │    385   # 🚀 PONTO DE ENTRADA DA APLICAÇÃO                                                                                                                                                         │
 │    386   # =====================================================================================                                                                                                    │
 ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ O método _save_artifact foi removido.

  Com esta correção, o pipeline de treinamento deve ser concluído com sucesso. Vou executar a sequência de comandos novamente.
 ╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
 │ ✔  Shell make make-dataset && make build-features && make train                                                                                                                                     │
 │                                                                                                                                                                                                     │
 │    Creating the dataset...                                                                                                                                                                          │
 │    Command: python /home/trustshield/src/data/make_dataset.py                                                                                                                                       │
 │    docker compose -f docker-compose.yml run --rm trustshield-api python /home/trustshield/src/data/make_dataset.py                                                                                  │
 │    [2025-08-01 01:43:24] [ENTRYPOINT] INFO: Aguardando pelo serviço: PostgreSQL em postgres:5432...                                                                                                 │
 │                                                                                                                                                                                                     │
 │    [2025-08-01 01:43:24] [ENTRYPOINT] INFO: Serviço PostgreSQL está pronto!                                                                                                                         │
 │    [2025-08-01 01:43:24] [ENTRYPOINT] INFO: Aguardando pelo serviço: MinIO em minio:9000...                                                                                                         │
 │                                                                                                                                                                                                     │
 │    [2025-08-01 01:43:24] [ENTRYPOINT] INFO: Serviço MinIO está pronto!                                                                                                                              │
 │    [2025-08-01 01:43:24] [ENTRYPOINT] INFO: Aguardando pelo serviço: MLflow UI em mlflow:5000...                                                                                                    │
 │                                                                                                                                                                                                     │
 │    [2025-08-01 01:43:24] [ENTRYPOINT] INFO: Serviço MLflow UI está pronto!                                                                                                                          │
 │    [2025-08-01 01:43:24] [ENTRYPOINT] INFO: Todos os serviços estão operacionais. Executando o comando principal...                                                                                 │
 │    {"timestamp": "2025-08-01 01:43:24,862", "level": "INFO", "message": "Pipeline de cria\u00e7\u00e3o de dataset iniciado.", "module": "__main__"}                                                 │
 │    {"timestamp": "2025-08-01 01:43:24,862", "level": "INFO", "message": "Iniciando carregamento de dados do diret\u00f3rio: /home/trustshield/data/raw", "module": "__main__"}                      │
 │    {"timestamp": "2025-08-01 01:43:36,494", "level": "INFO", "message": "Dados carregados com sucesso: 13305915 transa\u00e7\u00f5es, 2000 usu\u00e1rios, 109 c\u00f3digos MCC.", "module":         │
 │    "__main__"}                                                                                                                                                                                      │
 │    {"timestamp": "2025-08-01 01:43:36,494", "level": "INFO", "message": "Iniciando valida\u00e7\u00e3o de schema dos dados.", "module": "__main__"}                                                 │
 │    {"timestamp": "2025-08-01 01:43:36,494", "level": "INFO", "message": "Valida\u00e7\u00e3o de schema conclu\u00edda com sucesso.", "module": "__main__"}                                          │
 │    {"timestamp": "2025-08-01 01:43:36,494", "level": "INFO", "message": "Iniciando a mesclagem dos datasets de transa\u00e7\u00f5es e usu\u00e1rios.", "module": "__main__"}                        │
 │    {"timestamp": "2025-08-01 01:43:39,650", "level": "INFO", "message": "Mesclagem conclu\u00edda. Dataset final possui 13305915 registros.", "module": "__main__"}                                 │
 │    {"timestamp": "2025-08-01 01:43:39,651", "level": "INFO", "message": "Salvando dataset processado em: /home/trustshield/data/processed", "module": "__main__"}                                   │
 │    {"timestamp": "2025-08-01 01:43:53,244", "level": "INFO", "message": "Dataset salvo com sucesso em /home/trustshield/data/processed/primary_dataset.parquet.", "module": "__main__"}             │
 │    {"timestamp": "2025-08-01 01:43:53,244", "level": "INFO", "message": "Pipeline de cria\u00e7\u00e3o de dataset conclu\u00eddo com sucesso.", "module": "__main__"}                               │
 │    🛠️  Executando a engenharia de features no ambiente unificado...                                                                                                                                │
 │       Comando: python /home/trustshield/src/features/build_features.py                                                                                                                              │
 │    docker compose -f docker-compose.yml run --rm trustshield-api python /home/trustshield/src/features/build_features.py                                                                            │
 │    [2025-08-01 01:43:55] [ENTRYPOINT] INFO: Aguardando pelo serviço: PostgreSQL em postgres:5432...                                                                                                 │
 │                                                                                                                                                                                                     │
 │    [2025-08-01 01:43:55] [ENTRYPOINT] INFO: Serviço PostgreSQL está pronto!                                                                                                                         │
 │    [2025-08-01 01:43:55] [ENTRYPOINT] INFO: Aguardando pelo serviço: MinIO em minio:9000...                                                                                                         │
 │                                                                                                                                                                                                     │
 │    [2025-08-01 01:43:55] [ENTRYPOINT] INFO: Serviço MinIO está pronto!                                                                                                                              │
 │    [2025-08-01 01:43:55] [ENTRYPOINT] INFO: Aguardando pelo serviço: MLflow UI em mlflow:5000...                                                                                                    │
 │                                                                                                                                                                                                     │
 │    [2025-08-01 01:43:55] [ENTRYPOINT] INFO: Serviço MLflow UI está pronto!                                                                                                                          │
 │    [2025-08-01 01:43:55] [ENTRYPOINT] INFO: Todos os serviços estão operacionais. Executando o comando principal...                                                                                 │
 │    2025-08-01 01:43:56,068 - [TrustShield] - INFO - 🚀 Pipeline de engenharia de features iniciado.                                                                                                 │
 │    2025-08-01 01:43:56,068 - [TrustShield] - INFO - Carregando dados de /home/trustshield/data/processed/primary_dataset.parquet                                                                    │
 │    2025-08-01 01:44:00,745 - [TrustShield] - INFO - Iniciando limpeza de dados...                                                                                                                   │
 │    2025-08-01 01:44:31,055 - [TrustShield] - INFO - Limpeza de dados concluída.                                                                                                                     │
 │    2025-08-01 01:44:31,055 - [TrustShield] - INFO - Iniciando engenharia de features...                                                                                                             │
 │    2025-08-01 01:44:32,095 - [TrustShield] - INFO - Engenharia de features concluída.                                                                                                               │
 │    2025-08-01 01:44:32,095 - [TrustShield] - INFO - Salvando dataset com features em /home/trustshield/data/features/featured_dataset.parquet                                                       │
 │    2025-08-01 01:44:43,000 - [TrustShield] - INFO - ✅ Pipeline de engenharia de features concluído com sucesso.                                                                                     │
 │    🧠 Executando o pipeline de treino no ambiente unificado...                                                                                                                                      │
 │       Comando: python /home/trustshield/src/models/train_fraud_model.py --model isolation_forest                                                                                                    │
 │    docker compose -f docker-compose.yml run --rm trustshield-api python /home/trustshield/src/models/train_fraud_model.py --model isolation_forest                                                  │
 │    [2025-08-01 01:44:45] [ENTRYPOINT] INFO: Aguardando pelo serviço: PostgreSQL em postgres:5432...                                                                                                 │
 │                                                                                                                                                                                                     │
 │    [2025-08-01 01:44:45] [ENTRYPOINT] INFO: Serviço PostgreSQL está pronto!                                                                                                                         │
 │    [2025-08-01 01:44:45] [ENTRYPOINT] INFO: Aguardando pelo serviço: MinIO em minio:9000...                                                                                                         │
 │                                                                                                                                                                                                     │
 │    [2025-08-01 01:44:45] [ENTRYPOINT] INFO: Serviço MinIO está pronto!                                                                                                                              │
 │    [2025-08-01 01:44:45] [ENTRYPOINT] INFO: Aguardando pelo serviço: MLflow UI em mlflow:5000...                                                                                                    │
 │                                                                                                                                                                                                     │
 │    [2025-08-01 01:44:45] [ENTRYPOINT] INFO: Serviço MLflow UI está pronto!                                                                                                                          │
 │    [2025-08-01 01:44:45] [ENTRYPOINT] INFO: Todos os serviços estão operacionais. Executando o comando principal...                                                                                 │
 │    ❌ ERRO CRÍTICO: name 'MLflowObserver' is not defined                                                                                                                                             │
 │                                                                                                                                                                                                     │
 │     Container trustshield-minio  Running                                                                                                                                                            │
 │     Container trustshield-postgres  Running                                                                                                                                                         │
 │     Container trustshield-mlflow  Running                                                                                                                                                           │
 │     Container trustshield-minio  Waiting                                                                                                                                                            │
 │     Container trustshield-minio  Healthy                                                                                                                                                            │
 │     Container trustshield-create-buckets-1  Starting                                                                                                                                                │
 │     Container trustshield-create-buckets-1  Started                                                                                                                                                 │
 │     Container trustshield-create-buckets-1  Waiting                                                                                                                                                 │
 │     Container trustshield-postgres  Waiting                                                                                                                                                         │
 │     Container trustshield-postgres  Healthy                                                                                                                                                         │
 │     Container trustshield-create-buckets-1  Exited                                                                                                                                                  │
 │     Container trustshield-minio  Running                                                                                                                                                            │
 │     Container trustshield-postgres  Running                                                                                                                                                         │
 │     Container trustshield-mlflow  Running                                                                                                                                                           │
 │     Container trustshield-minio  Waiting                                                                                                                                                            │
 │     Container trustshield-minio  Healthy                                                                                                                                                            │
 │     Container trustshield-create-buckets-1  Starting                                                                                                                                                │
 │     Container trustshield-create-buckets-1  Started                                                                                                                                                 │
 │     Container trustshield-postgres  Waiting                                                                                                                                                         │
 │     Container trustshield-create-buckets-1  Waiting                                                                                                                                                 │
 │     Container trustshield-create-buckets-1  Exited                                                                                                                                                  │
 │     Container trustshield-postgres  Healthy                                                                                                                                                         │
 │     Container trustshield-postgres  Running                                                                                                                                                         │
 │     Container trustshield-minio  Running                                                                                                                                                            │
 │     Container trustshield-mlflow  Running                                                                                                                                                           │
 │     Container trustshield-minio  Waiting                                                                                                                                                            │
 │     Container trustshield-minio  Healthy                                                                                                                                                            │
 │     Container trustshield-create-buckets-1  Starting                                                                                                                                                │
 │     Container trustshield-create-buckets-1  Started                                                                                                                                                 │
 │     Container trustshield-create-buckets-1  Waiting                                                                                                                                                 │
 │     Container trustshield-postgres  Waiting                                                                                                                                                         │
 │     Container trustshield-create-buckets-1  Exited                                                                                                                                                  │
 │     Container trustshield-postgres  Healthy                                                                                                                                                         │
 │                                                                                                                                                                                                     │
 │    make: *** [Makefile:65: train] Erro 1                                                                                                                                                            │
 │                                                                                                                                                                                                     │
 ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ A análise da última execução revela o erro name 'MLflowObserver' is not defined. Este erro ocorreu porque, ao remover a classe MLflowObserver, esqueci de remover a linha que a anexa ao Subject no
  construtor da classe AdvancedTrustShieldTrainer.

  Para corrigir isso, vou remover a linha self.attach(MLflowObserver(self.config.get('mlflow', {}).get('experiment_name', 'TrustShield'), config_path)) do arquivo src/models/train_fraud_model.py.

  Vou aplicar esta correção.
 ╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
 │ ✔  Edit src/models/train_fraud_model.py:         self.attach(ConsoleLog... =>         self.attach(ConsoleLog...                                                                                     │
 │                                                                                                                                                                                                     │
 │    300       self.logger = AdvancedLogger('TrustShield')                                                                                                                                            │
 │    301       self.data_repository = ParquetDataRepository(self.config, self.project_root, use_dask=self.use_dask)                                                                                   │
 │    302       self.attach(ConsoleLogObserver(self.logger))                                                                                                                                           │
 │    303 -     self.attach(MLflowObserver(self.config.get('mlflow', {}).get('experiment_name', 'TrustShield'), config_path))                                                                          │
 │    303       self._setup_environment()                                                                                                                                                              │
 │    304                                                                                                                                                                                              │
 │    305   def _load_and_validate_config(self, config_path: str) -> Dict[str, Any]:                                                                                                                   │
 ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ A linha que anexa o MLflowObserver foi removida.

  Com esta correção, o pipeline de treinamento deve ser concluído com sucesso. Vou executar a sequência de comandos novamente.
 ╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
 │ ✔  Shell make make-dataset && make build-features && make train                                                                                                                                     │
 │                                                                                                                                                                                                     │
 │    Creating the dataset...                                                                                                                                                                          │
 │    Command: python /home/trustshield/src/data/make_dataset.py                                                                                                                                       │
 │    docker compose -f docker-compose.yml run --rm trustshield-api python /home/trustshield/src/data/make_dataset.py                                                                                  │
 │    [2025-08-01 01:45:03] [ENTRYPOINT] INFO: Aguardando pelo serviço: PostgreSQL em postgres:5432...                                                                                                 │
 │                                                                                                                                                                                                     │
 │    [2025-08-01 01:45:03] [ENTRYPOINT] INFO: Serviço PostgreSQL está pronto!                                                                                                                         │
 │    [2025-08-01 01:45:03] [ENTRYPOINT] INFO: Aguardando pelo serviço: MinIO em minio:9000...                                                                                                         │
 │                                                                                                                                                                                                     │
 │    [2025-08-01 01:45:03] [ENTRYPOINT] INFO: Serviço MinIO está pronto!                                                                                                                              │
 │    [2025-08-01 01:45:03] [ENTRYPOINT] INFO: Aguardando pelo serviço: MLflow UI em mlflow:5000...                                                                                                    │
 │                                                                                                                                                                                                     │
 │    [2025-08-01 01:45:03] [ENTRYPOINT] INFO: Serviço MLflow UI está pronto!                                                                                                                          │
 │    [2025-08-01 01:45:03] [ENTRYPOINT] INFO: Todos os serviços estão operacionais. Executando o comando principal...                                                                                 │
 │    {"timestamp": "2025-08-01 01:45:04,498", "level": "INFO", "message": "Pipeline de cria\u00e7\u00e3o de dataset iniciado.", "module": "__main__"}                                                 │
 │    {"timestamp": "2025-08-01 01:45:04,499", "level": "INFO", "message": "Iniciando carregamento de dados do diret\u00f3rio: /home/trustshield/data/raw", "module": "__main__"}                      │
 │    {"timestamp": "2025-08-01 01:45:16,021", "level": "INFO", "message": "Dados carregados com sucesso: 13305915 transa\u00e7\u00f5es, 2000 usu\u00e1rios, 109 c\u00f3digos MCC.", "module":         │
 │    "__main__"}                                                                                                                                                                                      │
 │    {"timestamp": "2025-08-01 01:45:16,021", "level": "INFO", "message": "Iniciando valida\u00e7\u00e3o de schema dos dados.", "module": "__main__"}                                                 │
 │    {"timestamp": "2025-08-01 01:45:16,021", "level": "INFO", "message": "Valida\u00e7\u00e3o de schema conclu\u00edda com sucesso.", "module": "__main__"}                                          │
 │    {"timestamp": "2025-08-01 01:45:16,021", "level": "INFO", "message": "Iniciando a mesclagem dos datasets de transa\u00e7\u00f5es e usu\u00e1rios.", "module": "__main__"}                        │
 │    {"timestamp": "2025-08-01 01:45:19,040", "level": "INFO", "message": "Mesclagem conclu\u00edda. Dataset final possui 13305915 registros.", "module": "__main__"}                                 │
 │    {"timestamp": "2025-08-01 01:45:19,040", "level": "INFO", "message": "Salvando dataset processado em: /home/trustshield/data/processed", "module": "__main__"}                                   │
 │    {"timestamp": "2025-08-01 01:45:32,373", "level": "INFO", "message": "Dataset salvo com sucesso em /home/trustshield/data/processed/primary_dataset.parquet.", "module": "__main__"}             │
 │    {"timestamp": "2025-08-01 01:45:32,374", "level": "INFO", "message": "Pipeline de cria\u00e7\u00e3o de dataset conclu\u00eddo com sucesso.", "module": "__main__"}                               │
 │    🛠️  Executando a engenharia de features no ambiente unificado...                                                                                                                                │
 │       Comando: python /home/trustshield/src/features/build_features.py                                                                                                                              │
 │    docker compose -f docker-compose.yml run --rm trustshield-api python /home/trustshield/src/features/build_features.py                                                                            │
 │    [2025-08-01 01:45:34] [ENTRYPOINT] INFO: Aguardando pelo serviço: PostgreSQL em postgres:5432...                                                                                                 │
 │                                                                                                                                                                                                     │
 │    [2025-08-01 01:45:34] [ENTRYPOINT] INFO: Serviço PostgreSQL está pronto!                                                                                                                         │
 │    [2025-08-01 01:45:34] [ENTRYPOINT] INFO: Aguardando pelo serviço: MinIO em minio:9000...                                                                                                         │
 │                                                                                                                                                                                                     │
 │    [2025-08-01 01:45:34] [ENTRYPOINT] INFO: Serviço MinIO está pronto!                                                                                                                              │
 │    [2025-08-01 01:45:34] [ENTRYPOINT] INFO: Aguardando pelo serviço: MLflow UI em mlflow:5000...                                                                                                    │
 │                                                                                                                                                                                                     │
 │    [2025-08-01 01:45:34] [ENTRYPOINT] INFO: Serviço MLflow UI está pronto!                                                                                                                          │
 │    [2025-08-01 01:45:34] [ENTRYPOINT] INFO: Todos os serviços estão operacionais. Executando o comando principal...                                                                                 │
 │    2025-08-01 01:45:34,985 - [TrustShield] - INFO - 🚀 Pipeline de engenharia de features iniciado.                                                                                                 │
 │    2025-08-01 01:45:34,985 - [TrustShield] - INFO - Carregando dados de /home/trustshield/data/processed/primary_dataset.parquet                                                                    │
 │    2025-08-01 01:45:39,574 - [TrustShield] - INFO - Iniciando limpeza de dados...                                                                                                                   │
 │    2025-08-01 01:46:08,101 - [TrustShield] - INFO - Limpeza de dados concluída.                                                                                                                     │
 │    2025-08-01 01:46:08,101 - [TrustShield] - INFO - Iniciando engenharia de features...                                                                                                             │
 │    2025-08-01 01:46:09,072 - [TrustShield] - INFO - Engenharia de features concluída.                                                                                                               │
 │    2025-08-01 01:46:09,072 - [TrustShield] - INFO - Salvando dataset com features em /home/trustshield/data/features/featured_dataset.parquet                                                       │
 │    2025-08-01 01:46:19,645 - [TrustShield] - INFO - ✅ Pipeline de engenharia de features concluído com sucesso.                                                                                     │
 │    🧠 Executando o pipeline de treino no ambiente unificado...                                                                                                                                      │
 │       Comando: python /home/trustshield/src/models/train_fraud_model.py --model isolation_forest                                                                                                    │
 │    docker compose -f docker-compose.yml run --rm trustshield-api python /home/trustshield/src/models/train_fraud_model.py --model isolation_forest                                                  │
 │    [2025-08-01 01:46:21] [ENTRYPOINT] INFO: Aguardando pelo serviço: PostgreSQL em postgres:5432...                                                                                                 │
 │                                                                                                                                                                                                     │
 │    [2025-08-01 01:46:21] [ENTRYPOINT] INFO: Serviço PostgreSQL está pronto!                                                                                                                         │
 │    [2025-08-01 01:46:21] [ENTRYPOINT] INFO: Aguardando pelo serviço: MinIO em minio:9000...                                                                                                         │
 │                                                                                                                                                                                                     │
 │    [2025-08-01 01:46:21] [ENTRYPOINT] INFO: Serviço MinIO está pronto!                                                                                                                              │
 │    [2025-08-01 01:46:21] [ENTRYPOINT] INFO: Aguardando pelo serviço: MLflow UI em mlflow:5000...                                                                                                    │
 │                                                                                                                                                                                                     │
 │    [2025-08-01 01:46:21] [ENTRYPOINT] INFO: Serviço MLflow UI está pronto!                                                                                                                          │
 │    [2025-08-01 01:46:21] [ENTRYPOINT] INFO: Todos os serviços estão operacionais. Executando o comando principal...                                                                                 │
 │    2025-08-01 01:46:23,615 - [TrustShield-Trainer] - INFO - 🚀 === INICIANDO PIPELINE DE TREINO (ID: bde27823) ===                                                                                  │
 │    2025-08-01 01:46:23,616 - [TrustShield-Trainer] - INFO - 📁 Carregando e preparando dados...                                                                                                     │
 │    2025-08-01 01:46:26,895 - [TrustShield-Trainer] - INFO - ✅ Dados prontos: 113,100 para treino, 19,959 para teste.                                                                                │
 │    2025-08-01 01:46:26,895 - [TrustShield-Trainer] - INFO -                                                                                                                                         │
 │    ============================================================                                                                                                                                     │
 │    🎯 TREINANDO MODELO: ISOLATION_FOREST                                                                                                                                                            │
 │    ============================================================                                                                                                                                     │
 │    2025-08-01 01:46:28,093 - [TrustShield-Trainer] - INFO - ✅ Modelo isolation_forest treinado com sucesso.                                                                                         │
 │    2025-08-01 01:46:28,340 - [TrustShield-Trainer] - INFO - 📊 Métricas: Anomalias=0.0985 | Inferência=143.3ms | CPU=39.0%                                                                          │
 │    2025-08-01 01:46:28,393 - [TrustShield-Trainer] - INFO - 💾 Artefato completo (modelo + scaler) salvo em: runs:/e588eea92b1c4dbf8935eba3af1882ba/model                                           │
 │    🏃 View run isolation_forest_20250801_014628 at: http://mlflow:5000/#/experiments/1/runs/e588eea92b1c4dbf8935eba3af1882ba                                                                        │
 │    🧪 View experiment at: http://mlflow:5000/#/experiments/1                                                                                                                                        │
 │                                                                                                                                                                                                     │
 │     Container trustshield-postgres  Running                                                                                                                                                         │
 │     Container trustshield-minio  Running                                                                                                                                                            │
 │     Container trustshield-mlflow  Running                                                                                                                                                           │
 │     Container trustshield-minio  Waiting                                                                                                                                                            │
 │     Container trustshield-minio  Healthy                                                                                                                                                            │
 │     Container trustshield-create-buckets-1  Starting                                                                                                                                                │
 │     Container trustshield-create-buckets-1  Started                                                                                                                                                 │
 │     Container trustshield-create-buckets-1  Waiting                                                                                                                                                 │
 │     Container trustshield-postgres  Waiting                                                                                                                                                         │
 │     Container trustshield-create-buckets-1  Exited                                                                                                                                                  │
 │     Container trustshield-postgres  Healthy                                                                                                                                                         │
 │     Container trustshield-minio  Running                                                                                                                                                            │
 │     Container trustshield-postgres  Running                                                                                                                                                         │
 │     Container trustshield-mlflow  Running                                                                                                                                                           │
 │     Container trustshield-minio  Waiting                                                                                                                                                            │
 │     Container trustshield-minio  Healthy                                                                                                                                                            │
 │     Container trustshield-create-buckets-1  Starting                                                                                                                                                │
 │     Container trustshield-create-buckets-1  Started                                                                                                                                                 │
 │     Container trustshield-postgres  Waiting                                                                                                                                                         │
 │     Container trustshield-create-buckets-1  Waiting                                                                                                                                                 │
 │     Container trustshield-postgres  Healthy                                                                                                                                                         │
 │     Container trustshield-create-buckets-1  Exited                                                                                                                                                  │
 │     Container trustshield-minio  Running                                                                                                                                                            │
 │     Container trustshield-postgres  Running                                                                                                                                                         │
 │     Container trustshield-mlflow  Running                                                                                                                                                           │
 │     Container trustshield-minio  Waiting                                                                                                                                                            │
 │     Container trustshield-minio  Healthy                                                                                                                                                            │
 │     Container trustshield-create-buckets-1  Starting                                                                                                                                                │
 │     Container trustshield-create-buckets-1  Started                                                                                                                                                 │
 │     Container trustshield-create-buckets-1  Waiting                                                                                                                                                 │
 │     Container trustshield-postgres  Waiting                                                                                                                                                         │
 │     Container trustshield-postgres  Healthy                                                                                                                                                         │
 │     Container trustshield-create-buckets-1  Exited                                                                                                                                                  │
 │    2025/08/01 01:46:28 WARNING mlflow.utils.git_utils: Failed to import Git (the Git executable is probably not on your PATH), so Git SHA is not available. Error: Failed to initialize: Bad git    │
 │    executable.                                                                                                                                                                                      │
 │    The git executable must be specified in one of the following ways:                                                                                                                               │
 │        - be included in your $PATH                                                                                                                                                                  │
 │        - be set via $GIT_PYTHON_GIT_EXECUTABLE                                                                                                                                                      │
 │        - explicitly set via git.refresh(<full-path-to-git-executable>)                                                                                                                              │
 │                                                                                                                                                                                                     │
 │    All git commands will error until this is rectified.                                                                                                                                             │
 │                                                                                                                                                                                                     │
 │    This initial message can be silenced or aggravated in the future by setting the                                                                                                                  │
 │    $GIT_PYTHON_REFRESH environment variable. Use one of the following values:                                                                                                                       │
 │        - quiet|q|silence|s|silent|none|n|0: for no message or exception                                                                                                                             │
 │        - warn|w|warning|log|l|1: for a warning message (logging level CRITICAL, displayed by default)                                                                                               │
 │        - error|e|exception|raise|r|2: for a raised exception                                                                                                                                        │
 │                                                                                                                                                                                                     │
 │    Example:                                                                                                                                                                                         │
 │        export GIT_PYTHON_REFRESH=quiet                                                                                                                                                              │
 │                                                                                                                                                                                                     │
 │    2025/08/01 01:46:28 WARNING mlflow.models.model: `artifact_path` is deprecated. Please use `name` instead.                                                                                       │
 │    2025/08/01 01:46:31 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model         │
 │    signature.                                                                                                                                                                                       │
 │    Registered model 'TrustShield-isolation_forest' already exists. Creating a new version of this model...                                                                                          │
 │    2025/08/01 01:46:31 WARNING mlflow.tracking._model_registry.fluent: Run with id e588eea92b1c4dbf8935eba3af1882ba has no artifacts at artifact path 'model', registering model based on           │
 │    models:/m-8d791f4a890c42cd9b3273b78f978919 instead                                                                                                                                               │
 │    2025/08/01 01:46:31 INFO mlflow.store.model_registry.abstract_store: Waiting up to 300 seconds for model version to finish creation. Model name: TrustShield-isolation_forest, version 1         │
 │    Created version '1' of model 'TrustShield-isolation_forest'.                                                                                                                                     │
 │                                                                                                                                                                                                     │
 ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ Excelente! A última execução do pipeline foi um sucesso.

  Todos os erros anteriores foram resolvidos. O pipeline completo, desde a criação do dataset até o treinamento e registro do modelo no MLflow, foi executado sem falhas.

  O modelo isolation_forest foi treinado e uma nova versão foi registrada com sucesso no MLflow, como indicado pelos logs.

  O que você gostaria de fazer agora?

╭───────────────────────────────────────╮
│  > Verificar a situação do LocalHost  │
╰───────────────────────────────────────╯

✦ Para verificar o status dos serviços rodando localmente, vou usar o comando docker compose ps. Ele mostrará todos os contêineres gerenciados pelo docker-compose.yml, seus status e as portas que estão
  usando.
 ╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
 │ ✔  Shell docker compose ps (Verifica o status dos contêineres Docker gerenciados pelo Docker Compose, mostrando quais serviços estão em execução e em quais portas.)                                │
 │                                                                                                                                                                                                     │
 │    NAME                   IMAGE                         COMMAND                  SERVICE           CREATED        STATUS                    PORTS                                                   │
 │    trustshield-api        trustshield-trustshield-api   "/usr/local/bin/entr…"   trustshield-api   20 hours ago   Up 20 hours (unhealthy)   0.0.0.0:8000->8000/tcp, [::]:8000->8000/tcp             │
 │    trustshield-minio      minio/minio:latest            "/usr/bin/docker-ent…"   minio             20 hours ago   Up 20 hours (healthy)     0.0.0.0:9000-9001->9000-9001/tcp,                       │
 │    [::]:9000-9001->9000-9001/tcp                                                                                                                                                                    │
 │    trustshield-mlflow     trustshield-mlflow            "mlflow server --hos…"   mlflow            20 hours ago   Up 20 hours               0.0.0.0:5000->5000/tcp, [::]:5000->5000/tcp             │
 │    trustshield-postgres   postgres:13.12                "docker-entrypoint.s…"   postgres          20 hours ago   Up 20 hours (healthy)     0.0.0.0:5432->5432/tcp, [::]:5432->5432/tcp             │
 │                                                                                                                                                                                                     │
 ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ A saída do comando docker compose ps mostra que todos os serviços essenciais estão em execução:

   * `trustshield-api`: O serviço da API está rodando, mas com o status unhealthy. Isso indica que, embora o contêiner esteja ativo, a aplicação dentro dele não está respondendo corretamente às verificações
     de saúde. Isso pode ser um problema temporário ou indicar uma falha na inicialização da API.
   * `trustshield-minio`: O MinIO (armazenamento de objetos) está rodando e healthy.
   * `trustshield-mlflow`: O MLflow (plataforma de MLOps) está rodando.
   * `trustshield-postgres`: O banco de dados PostgreSQL está rodando e healthy.

  O ponto de atenção é o status unhealthy do serviço trustshield-api. Vou investigar os logs deste serviço para entender a causa do problema.
 ╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
 │ ✔  Shell docker compose logs trustshield-api (Exibe os logs do contêiner trustshield-api para diagnosticar o motivo do status 'unhealthy'.)                                                         │
 │                                                                                                                                                                                                     │
 │    trustshield-api  | [2025-07-31 05:23:26] [ENTRYPOINT] INFO: Aguardando pelo serviço: PostgreSQL em postgres:5432...                                                                              │
 │    trustshield-api  |                                                                                                                                                                               │
 │    trustshield-api  | [2025-07-31 05:23:26] [ENTRYPOINT] INFO: Serviço PostgreSQL está pronto!                                                                                                      │
 │    trustshield-api  | [2025-07-31 05:23:26] [ENTRYPOINT] INFO: Aguardando pelo serviço: MinIO em minio:9000...                                                                                      │
 │    trustshield-api  |                                                                                                                                                                               │
 │    trustshield-api  | [2025-07-31 05:23:26] [ENTRYPOINT] INFO: Serviço MinIO está pronto!                                                                                                           │
 │    trustshield-api  | [2025-07-31 05:23:26] [ENTRYPOINT] INFO: Aguardando pelo serviço: MLflow UI em mlflow:5000...                                                                                 │
 │    trustshield-api  | .                                                                                                                                                                             │
 │    trustshield-api  | [2025-07-31 05:23:28] [ENTRYPOINT] INFO: Serviço MLflow UI está pronto!                                                                                                       │
 │    trustshield-api  | [2025-07-31 05:23:28] [ENTRYPOINT] INFO: Todos os serviços estão operacionais. Executando o comando principal...                                                              │
 │    trustshield-api  | INFO:     Started server process [1]                                                                                                                                          │
 │    trustshield-api  | INFO:     Waiting for application startup.                                                                                                                                    │
 │    trustshield-api  | 2025-07-31 05:23:29,810 - trustshield_api - INFO - Iniciando ciclo de vida da API...                                                                                          │
 │    trustshield-api  | 2025-07-31 05:23:29,811 - [TrustShield-Predictor] - ERROR - ❌ Falha na detecção automática de caminhos: Nenhum modelo encontrado no diretório:                                │
 │    /home/trustshield/outputs/models                                                                                                                                                                 │
 │    trustshield-api  | 2025-07-31 05:23:29,811 - TrustShieldPredictor - ERROR - ❌ Falha na detecção automática de caminhos: Nenhum modelo encontrado no diretório:                                   │
 │    /home/trustshield/outputs/models                                                                                                                                                                 │
 │    trustshield-api  | 2025-07-31 05:23:29,811 - [TrustShield-Predictor] - CRITICAL - ❌ Erro crítico na inicialização do preditor: Nenhum modelo encontrado no diretório:                            │
 │    /home/trustshield/outputs/models                                                                                                                                                                 │
 │    trustshield-api  | Traceback (most recent call last):                                                                                                                                            │
 │    trustshield-api  |   File "/home/trustshield/src/models/predict.py", line 117, in __init__                                                                                                       │
 │    trustshield-api  |     self.model_path = model_path or self._auto_detect_paths()                                                                                                                 │
 │    trustshield-api  |   File "/home/trustshield/src/models/predict.py", line 169, in _auto_detect_paths                                                                                             │
 │    trustshield-api  |     raise FileNotFoundError(f"Nenhum modelo encontrado no diretório: {model_dir}")                                                                                            │
 │    trustshield-api  | FileNotFoundError: Nenhum modelo encontrado no diretório: /home/trustshield/outputs/models                                                                                    │
 │    trustshield-api  | 2025-07-31 05:23:29,811 - TrustShieldPredictor - CRITICAL - ❌ Erro crítico na inicialização do preditor: Nenhum modelo encontrado no diretório:                               │
 │    /home/trustshield/outputs/models                                                                                                                                                                 │
 │    trustshield-api  | Traceback (most recent call last):                                                                                                                                            │
 │    trustshield-api  |   File "/home/trustshield/src/models/predict.py", line 117, in __init__                                                                                                       │
 │    trustshield-api  |     self.model_path = model_path or self._auto_detect_paths()                                                                                                                 │
 │    trustshield-api  |   File "/home/trustshield/src/models/predict.py", line 169, in _auto_detect_paths                                                                                             │
 │    trustshield-api  |     raise FileNotFoundError(f"Nenhum modelo encontrado no diretório: {model_dir}")                                                                                            │
 │    trustshield-api  | FileNotFoundError: Nenhum modelo encontrado no diretório: /home/trustshield/outputs/models                                                                                    │
 │    trustshield-api  | 2025-07-31 05:23:29,812 - trustshield_api - CRITICAL - Falha crítica ao carregar o modelo na inicialização: Nenhum modelo encontrado no diretório:                            │
 │    /home/trustshield/outputs/models                                                                                                                                                                 │
 │    trustshield-api  | Traceback (most recent call last):                                                                                                                                            │
 │    trustshield-api  |   File "/home/trustshield/src/api/main.py", line 43, in lifespan                                                                                                              │
 │    trustshield-api  |     app.state.predictor = TrustShieldPredictor()                                                                                                                              │
 │    trustshield-api  |   File "/home/trustshield/src/models/predict.py", line 117, in __init__                                                                                                       │
 │    trustshield-api  |     self.model_path = model_path or self._auto_detect_paths()                                                                                                                 │
 │    trustshield-api  |   File "/home/trustshield/src/models/predict.py", line 169, in _auto_detect_paths                                                                                             │
 │    trustshield-api  |     raise FileNotFoundError(f"Nenhum modelo encontrado no diretório: {model_dir}")                                                                                            │
 │    trustshield-api  | FileNotFoundError: Nenhum modelo encontrado no diretório: /home/trustshield/outputs/models                                                                                    │
 │    trustshield-api  | INFO:     Application startup complete.                                                                                                                                       │
 │    trustshield-api  | INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)                                                                                                       │
 │    trustshield-api  | INFO:     172.18.0.1:53170 - "GET / HTTP/1.1" 404 Not Found                                                                                                                   │
 │    trustshield-api  | INFO:     172.18.0.1:53172 - "GET /favicon.ico HTTP/1.1" 404 Not Found                                                                                                        │
 │    trustshield-api  | INFO:     172.18.0.1:37818 - "GET / HTTP/1.1" 404 Not Found                                                                                                                   │
 │    trustshield-api  | INFO:     172.18.0.1:37828 - "GET /favicon.ico HTTP/1.1" 404 Not Found                                                                                                        │
 │                                                                                                                                                                                                     │
 ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ A análise dos logs do contêiner trustshield-api revela a causa do status unhealthy:

  FileNotFoundError: Nenhum modelo encontrado no diretório: /home/trustshield/outputs/models

  Este erro ocorre porque a API, ao ser iniciada, tenta carregar o modelo treinado do diretório /home/trustshield/outputs/models, mas não encontra nenhum arquivo de modelo. Isso acontece porque o modelo é
  salvo com um nome de arquivo que inclui um timestamp, e a API não sabe qual é o nome do arquivo mais recente.

  Para resolver isso, vou modificar o script src/models/predict.py para que ele encontre o arquivo de modelo mais recente no diretório outputs/models e o carregue.

  Correção Proposta:

  Vou modificar a função _auto_detect_paths no script src/models/predict.py para que ela encontre o arquivo de modelo mais recente no diretório outputs/models.

  Vou aplicar esta correção.
 ╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
 │ ✔  Edit src/models/predict.py:     def _auto_detect_paths(sel... =>     def _auto_detect_paths(sel...                                                                                               │
 │                                                                                                                                                                                                     │
 │    149       except Exception as e:                                                                                                                                                                 │
 │    150           self.logger.warning(f"⚠️ Não foi possível obter informações detalhadas do sistema: {e}")                                                                                           │
 │    151                                                                                                                                                                                              │
 │    152 - def _auto_detect_paths(self) -> Path:                                                                                                                                                      │
 │    153 -     """Detecta automaticamente o caminho do modelo mais recente."""                                                                                                                        │
 │    154 -     try:                                                                                                                                                                                   │
 │    155 -         project_root = Path(__file__).resolve().parents[2]                                                                                                                                 │
 │    156 -         model_dir = project_root / "outputs" / "models"                                                                                                                                    │
 │    152 + def _auto_detect_paths(self) -> str:                                                                                                                                                       │
 │    153 +     model_dir = Path("/home/trustshield/outputs/models")                                                                                                                                   │
 │    154 +     if not model_dir.exists():                                                                                                                                                             │
 │    155 +         raise FileNotFoundError(f"Diretório de modelos não encontrado: {model_dir}")                                                                                                       │
 │    156                                                                                                                                                                                              │
 │    158 -         # Prioriza modelos 'isolation_forest' e depois busca o mais recente                                                                                                                │
 │    159 -         model_patterns = ["*isolation_forest*.joblib", "*.joblib"]                                                                                                                         │
 │    160 -         latest_model = None                                                                                                                                                                │
 │    157 +     latest_model = max(model_dir.glob("*.joblib"), key=lambda p: p.stat().st_mtime, default=None)                                                                                          │
 │    158                                                                                                                                                                                              │
 │    162 -         for pattern in model_patterns:                                                                                                                                                     │
 │    163 -             models = list(model_dir.glob(pattern))                                                                                                                                         │
 │    164 -             if models:                                                                                                                                                                     │
 │    165 -                 latest_model = max(models, key=lambda p: p.stat().st_mtime)                                                                                                                │
 │    166 -                 self.logger.info(f"📁 Modelo detectado automaticamente: {latest_model.name}")                                                                                              │
 │    167 -                 return latest_model                                                                                                                                                        │
 │    168 -                                                                                                                                                                                            │
 │    159 +     if not latest_model:                                                                                                                                                                   │
 │    160           raise FileNotFoundError(f"Nenhum modelo encontrado no diretório: {model_dir}")                                                                                                     │
 │    161                                                                                                                                                                                              │
 │    ═══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════  │
 │    171 -     except Exception as e:                                                                                                                                                                 │
 │    172 -         self.logger.error(f"❌ Falha na detecção automática de caminhos:  {e}")                                                                                                             │
 │    173 -         raise                                                                                                                                                                              │
 │    162 +     return str(latest_model)                                                                                                                                                               │
 │    163                                                                                                                                                                                              │
 │    164   def _load_artifacts(self):                                                                                                                                                                 │
 │    165       """                                                                                                                                                                                    │
 ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ A função _auto_detect_paths foi modificada para encontrar o arquivo de modelo mais recente.

  Agora, vou reiniciar o serviço da API para que ele carregue o modelo mais recente e se torne saudável.
 ╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
 │ ✔  Shell docker compose restart trustshield-api (Reinicia o serviço da API para que ele carregue o modelo mais recente e se torne saudável.)                                                        │
 │                                                                                                                                                                                                     │
 │                                                                                                                                                                                                     │
 │     Container trustshield-api  Restarting                                                                                                                                                           │
 │     Container trustshield-api  Started                                                                                                                                                              │
 │                                                                                                                                                                                                     │
 ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ O serviço trustshield-api foi reiniciado. Agora, vou verificar o status dos serviços novamente para confirmar que a API está saudável.
 ╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
 │ ✔  Shell docker compose ps (Verifica o status dos contêineres Docker para confirmar que a API está saudável.)                                                                                       │
 │                                                                                                                                                                                                     │
 │    NAME                   IMAGE                         COMMAND                  SERVICE           CREATED        STATUS                            PORTS                                           │
 │    trustshield-api        trustshield-trustshield-api   "/usr/local/bin/entr…"   trustshield-api   20 hours ago   Up 7 seconds (health: starting)   0.0.0.0:8000->8000/tcp, [::]:8000->8000/tcp     │
 │    trustshield-minio      minio/minio:latest            "/usr/bin/docker-ent…"   minio             20 hours ago   Up 20 hours (healthy)             0.0.0.0:9000-9001->9000-9001/tcp,               │
 │    [::]:9000-9001->9000-9001/tcp                                                                                                                                                                    │
 │    trustshield-mlflow     trustshield-mlflow            "mlflow server --hos…"   mlflow            20 hours ago   Up 20 hours                       0.0.0.0:5000->5000/tcp, [::]:5000->5000/tcp     │
 │    trustshield-postgres   postgres:13.12                "docker-entrypoint.s…"   postgres          20 hours ago   Up 20 hours (healthy)             0.0.0.0:5432->5432/tcp, [::]:5432->5432/tcp     │
 │                                                                                                                                                                                                     │
 ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ A saída do comando docker compose ps mostra que o serviço trustshield-api está com o status health: starting. Isso significa que o contêiner foi reiniciado e a verificação de saúde está em andamento.

  Vou aguardar alguns segundos e verificar o status novamente para confirmar que a API se tornou saudável.
 ╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
 │ ✔  Shell sleep 5 && docker compose ps (Aguarda 5 segundos e verifica o status dos contêineres Docker novamente para confirmar que a API está saudável.)                                             │
 │                                                                                                                                                                                                     │
 │    NAME                   IMAGE                         COMMAND                  SERVICE           CREATED        STATUS                             PORTS                                          │
 │    trustshield-api        trustshield-trustshield-api   "/usr/local/bin/entr…"   trustshield-api   20 hours ago   Up 47 seconds (health: starting)   0.0.0.0:8000->8000/tcp, [::]:8000->8000/tcp    │
 │    trustshield-minio      minio/minio:latest            "/usr/bin/docker-ent…"   minio             20 hours ago   Up 20 hours (healthy)              0.0.0.0:9000-9001->9000-9001/tcp,              │
 │    [::]:9000-9001->9000-9001/tcp                                                                                                                                                                    │
 │    trustshield-mlflow     trustshield-mlflow            "mlflow server --hos…"   mlflow            20 hours ago   Up 20 hours                        0.0.0.0:5000->5000/tcp, [::]:5000->5000/tcp    │
 │    trustshield-postgres   postgres:13.12                "docker-entrypoint.s…"   postgres          20 hours ago   Up 20 hours (healthy)              0.0.0.0:5432->5432/tcp, [::]:5432->5432/tcp    │
 │                                                                                                                                                                                                     │
 ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ A saída do comando docker compose ps ainda mostra o serviço trustshield-api com o status health: starting. Isso pode indicar que a aplicação está demorando mais do que o esperado para iniciar ou que ainda
  há um problema.

  Vou verificar os logs do serviço trustshield-api novamente para ver se há alguma nova mensagem de erro.
 ╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
 │ ✔  Shell docker compose logs trustshield-api (Exibe os logs do contêiner trustshield-api para diagnosticar o motivo do status 'health: starting'.)                                                  │
 │                                                                                                                                                                                                     │
 │    trustshield-api  | [2025-07-31 05:23:26] [ENTRYPOINT] INFO: Aguardando pelo serviço: PostgreSQL em postgres:5432...                                                                              │
 │    trustshield-api  |                                                                                                                                                                               │
 │    trustshield-api  | [2025-07-31 05:23:26] [ENTRYPOINT] INFO: Serviço PostgreSQL está pronto!                                                                                                      │
 │    trustshield-api  | [2025-07-31 05:23:26] [ENTRYPOINT] INFO: Aguardando pelo serviço: MinIO em minio:9000...                                                                                      │
 │    trustshield-api  |                                                                                                                                                                               │
 │    trustshield-api  | [2025-07-31 05:23:26] [ENTRYPOINT] INFO: Serviço MinIO está pronto!                                                                                                           │
 │    trustshield-api  | [2025-07-31 05:23:26] [ENTRYPOINT] INFO: Aguardando pelo serviço: MLflow UI em mlflow:5000...                                                                                 │
 │    trustshield-api  | .                                                                                                                                                                             │
 │    trustshield-api  | [2025-07-31 05:23:28] [ENTRYPOINT] INFO: Serviço MLflow UI está pronto!                                                                                                       │
 │    trustshield-api  | [2025-07-31 05:23:28] [ENTRYPOINT] INFO: Todos os serviços estão operacionais. Executando o comando principal...                                                              │
 │    trustshield-api  | INFO:     Started server process [1]                                                                                                                                          │
 │    trustshield-api  | INFO:     Waiting for application startup.                                                                                                                                    │
 │    trustshield-api  | 2025-07-31 05:23:29,810 - trustshield_api - INFO - Iniciando ciclo de vida da API...                                                                                          │
 │    trustshield-api  | 2025-07-31 05:23:29,811 - [TrustShield-Predictor] - ERROR - ❌ Falha na detecção automática de caminhos: Nenhum modelo encontrado no diretório:                                │
 │    /home/trustshield/outputs/models                                                                                                                                                                 │
 │    trustshield-api  | 2025-07-31 05:23:29,811 - TrustShieldPredictor - ERROR - ❌ Falha na detecção automática de caminhos: Nenhum modelo encontrado no diretório:                                   │
 │    /home/trustshield/outputs/models                                                                                                                                                                 │
 │    trustshield-api  | 2025-07-31 05:23:29,811 - [TrustShield-Predictor] - CRITICAL - ❌ Erro crítico na inicialização do preditor: Nenhum modelo encontrado no diretório:                            │
 │    /home/trustshield/outputs/models                                                                                                                                                                 │
 │    trustshield-api  | Traceback (most recent call last):                                                                                                                                            │
 │    trustshield-api  |   File "/home/trustshield/src/models/predict.py", line 117, in __init__                                                                                                       │
 │    trustshield-api  |     self.model_path = model_path or self._auto_detect_paths()                                                                                                                 │
 │    trustshield-api  |   File "/home/trustshield/src/models/predict.py", line 169, in _auto_detect_paths                                                                                             │
 │    trustshield-api  |     raise FileNotFoundError(f"Nenhum modelo encontrado no diretório: {model_dir}")                                                                                            │
 │    trustshield-api  | FileNotFoundError: Nenhum modelo encontrado no diretório: /home/trustshield/outputs/models                                                                                    │
 │    trustshield-api  | 2025-07-31 05:23:29,811 - TrustShieldPredictor - CRITICAL - ❌ Erro crítico na inicialização do preditor: Nenhum modelo encontrado no diretório:                               │
 │    /home/trustshield/outputs/models                                                                                                                                                                 │
 │    trustshield-api  | Traceback (most recent call last):                                                                                                                                            │
 │    trustshield-api  |   File "/home/trustshield/src/models/predict.py", line 117, in __init__                                                                                                       │
 │    trustshield-api  |     self.model_path = model_path or self._auto_detect_paths()                                                                                                                 │
 │    trustshield-api  |   File "/home/trustshield/src/models/predict.py", line 169, in _auto_detect_paths                                                                                             │
 │    trustshield-api  |     raise FileNotFoundError(f"Nenhum modelo encontrado no diretório: {model_dir}")                                                                                            │
 │    trustshield-api  | FileNotFoundError: Nenhum modelo encontrado no diretório: /home/trustshield/outputs/models                                                                                    │
 │    trustshield-api  | 2025-07-31 05:23:29,812 - trustshield_api - CRITICAL - Falha crítica ao carregar o modelo na inicialização: Nenhum modelo encontrado no diretório:                            │
 │    /home/trustshield/outputs/models                                                                                                                                                                 │
 │    trustshield-api  | Traceback (most recent call last):                                                                                                                                            │
 │    trustshield-api  |   File "/home/trustshield/src/api/main.py", line 43, in lifespan                                                                                                              │
 │    trustshield-api  |     app.state.predictor = TrustShieldPredictor()                                                                                                                              │
 │    trustshield-api  |   File "/home/trustshield/src/models/predict.py", line 117, in __init__                                                                                                       │
 │    trustshield-api  |     self.model_path = model_path or self._auto_detect_paths()                                                                                                                 │
 │    trustshield-api  |   File "/home/trustshield/src/models/predict.py", line 169, in _auto_detect_paths                                                                                             │
 │    trustshield-api  |     raise FileNotFoundError(f"Nenhum modelo encontrado no diretório: {model_dir}")                                                                                            │
 │    trustshield-api  | FileNotFoundError: Nenhum modelo encontrado no diretório: /home/trustshield/outputs/models                                                                                    │
 │    trustshield-api  | INFO:     Application startup complete.                                                                                                                                       │
 │    trustshield-api  | INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)                                                                                                       │
 │    trustshield-api  | INFO:     172.18.0.1:53170 - "GET / HTTP/1.1" 404 Not Found                                                                                                                   │
 │    trustshield-api  | INFO:     172.18.0.1:53172 - "GET /favicon.ico HTTP/1.1" 404 Not Found                                                                                                        │
 │    trustshield-api  | INFO:     172.18.0.1:37818 - "GET / HTTP/1.1" 404 Not Found                                                                                                                   │
 │    trustshield-api  | INFO:     172.18.0.1:37828 - "GET /favicon.ico HTTP/1.1" 404 Not Found                                                                                                        │
 │    trustshield-api  | INFO:     172.18.0.1:42698 - "GET / HTTP/1.1" 404 Not Found                                                                                                                   │
 │    trustshield-api  | INFO:     172.18.0.1:42702 - "GET /favicon.ico HTTP/1.1" 404 Not Found                                                                                                        │
 │    trustshield-api  | INFO:     Shutting down                                                                                                                                                       │
 │    trustshield-api  | INFO:     Waiting for application shutdown.                                                                                                                                   │
 │    trustshield-api  | 2025-08-01 01:48:02,111 - trustshield_api - INFO - Encerrando ciclo de vida da API e limpando recursos...                                                                     │
 │    trustshield-api  | INFO:     Application shutdown complete.                                                                                                                                      │
 │    trustshield-api  | INFO:     Finished server process [1]                                                                                                                                         │
 │    trustshield-api  | [2025-08-01 01:48:02] [ENTRYPOINT] INFO: Aguardando pelo serviço: PostgreSQL em postgres:5432...                                                                              │
 │    trustshield-api  |                                                                                                                                                                               │
 │    trustshield-api  | [2025-08-01 01:48:02] [ENTRYPOINT] INFO: Serviço PostgreSQL está pronto!                                                                                                      │
 │    trustshield-api  | [2025-08-01 01:48:02] [ENTRYPOINT] INFO: Aguardando pelo serviço: MinIO em minio:9000...                                                                                      │
 │    trustshield-api  |                                                                                                                                                                               │
 │    trustshield-api  | [2025-08-01 01:48:02] [ENTRYPOINT] INFO: Serviço MinIO está pronto!                                                                                                           │
 │    trustshield-api  | [2025-08-01 01:48:02] [ENTRYPOINT] INFO: Aguardando pelo serviço: MLflow UI em mlflow:5000...                                                                                 │
 │    trustshield-api  |                                                                                                                                                                               │
 │    trustshield-api  | [2025-08-01 01:48:02] [ENTRYPOINT] INFO: Serviço MLflow UI está pronto!                                                                                                       │
 │    trustshield-api  | [2025-08-01 01:48:02] [ENTRYPOINT] INFO: Todos os serviços estão operacionais. Executando o comando principal...                                                              │
 │    trustshield-api  | INFO:     Started server process [1]                                                                                                                                          │
 │    trustshield-api  | INFO:     Waiting for application startup.                                                                                                                                    │
 │    trustshield-api  | 2025-08-01 01:48:03,772 - trustshield_api - INFO - Iniciando ciclo de vida da API...                                                                                          │
 │    trustshield-api  | 2025-08-01 01:48:03,773 - [TrustShield-Predictor] - INFO - ============================================================                                                       │
 │    trustshield-api  | 2025-08-01 01:48:03,773 - [TrustShield-Predictor] - INFO - 🚀 INICIALIZANDO MOTOR DE INFERÊNCIA DE PRODUÇÃO                                                                   │
 │    trustshield-api  | 2025-08-01 01:48:03,773 - TrustShieldPredictor - INFO - ============================================================                                                          │
 │    trustshield-api  | 2025-08-01 01:48:03,773 - TrustShieldPredictor - INFO - 🚀 INICIALIZANDO MOTOR DE INFERÊNCIA DE PRODUÇÃO                                                                      │
 │    trustshield-api  | 2025-08-01 01:48:03,773 - [TrustShield-Predictor] - INFO - 💻 CPUs: 2 cores físicos @ 3230.22675 MHz                                                                          │
 │    trustshield-api  | 2025-08-01 01:48:03,773 - TrustShieldPredictor - INFO - 💻 CPUs: 2 cores físicos @ 3230.22675 MHz                                                                             │
 │    trustshield-api  | 2025-08-01 01:48:03,774 - [TrustShield-Predictor] - INFO - 🧠 RAM Total: 19.3 GB                                                                                              │
 │    trustshield-api  | 2025-08-01 01:48:03,774 - TrustShieldPredictor - INFO - 🧠 RAM Total: 19.3 GB                                                                                                 │
 │    trustshield-api  | 2025-08-01 01:48:03,774 - [TrustShield-Predictor] - INFO - ⚙️ Threads Otimizadas: 4 (Intel MKL/OMP)                                                                           │
 │    trustshield-api  | 2025-08-01 01:48:03,774 - TrustShieldPredictor - INFO - ⚙️ Threads Otimizadas: 4 (Intel MKL/OMP)                                                                              │
 │    trustshield-api  | 2025-08-01 01:48:03,774 - [TrustShield-Predictor] - INFO - ============================================================                                                       │
 │    trustshield-api  | 2025-08-01 01:48:03,774 - TrustShieldPredictor - INFO - ============================================================                                                          │
 │    trustshield-api  | 2025-08-01 01:48:03,774 - [TrustShield-Predictor] - INFO - 📥 Carregando artefatos de: /home/trustshield/outputs/models/isolation_forest_20250801_002239.joblib               │
 │    trustshield-api  | 2025-08-01 01:48:03,774 - TrustShieldPredictor - INFO - 📥 Carregando artefatos de: /home/trustshield/outputs/models/isolation_forest_20250801_002239.joblib                  │
 │    trustshield-api  | 2025-08-01 01:48:04,263 - [TrustShield-Predictor] - INFO - ✅ Artefatos carregados em 0.49s | Tipo: IsolationForest                                                            │
 │    trustshield-api  | 2025-08-01 01:48:04,263 - [TrustShield-Predictor] - INFO - 🎯 Modelo treinado com 24 features exatas.                                                                         │
 │    trustshield-api  | 2025-08-01 01:48:04,263 - [TrustShield-Predictor] - INFO - 🎯 Motor de Inferência TrustShield inicializado com sucesso!                                                       │
 │    trustshield-api  | 2025-08-01 01:48:04,263 - TrustShieldPredictor - INFO - ✅ Artefatos carregados em 0.49s | Tipo: IsolationForest                                                               │
 │    trustshield-api  | 2025-08-01 01:48:04,263 - TrustShieldPredictor - INFO - 🎯 Modelo treinado com 24 features exatas.                                                                            │
 │    trustshield-api  | 2025-08-01 01:48:04,263 - TrustShieldPredictor - INFO - 🎯 Motor de Inferência TrustShield inicializado com sucesso!                                                          │
 │    trustshield-api  | 2025-08-01 01:48:04,263 - trustshield_api - INFO - Motor de inferência carregado com sucesso no estado da aplicação.                                                          │
 │    trustshield-api  | INFO:     Application startup complete.                                                                                                                                       │
 │    trustshield-api  | INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)                                                                                                       │
 │                                                                                                                                                                                                     │
 ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
✦ A análise dos logs do contêiner trustshield-api mostra que o problema foi resolvido. A API agora está sendo iniciada com sucesso e o motor de inferência está sendo carregado corretamente.

  O status health: starting que vimos anteriormente era devido ao tempo que a API leva para iniciar e carregar o modelo. Agora que a API está em execução, o status deve ser healthy.

  Vou verificar o status dos serviços novamente para confirmar que a API está saudável.
 ╭─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
 │ ✔  Shell docker compose ps (Verifica o status dos contêineres Docker para confirmar que a API está saudável.)                                                                                       │
 │                                                                                                                                                                                                     │
 │    NAME                   IMAGE                         COMMAND                  SERVICE           CREATED        STATUS                                 PORTS                                      │
 │    trustshield-api        trustshield-trustshield-api   "/usr/local/bin/entr…"   trustshield-api   20 hours ago   Up About a minute (health: starting)   0.0.0.0:8000->8000/tcp,                    │
 │    [::]:8000->8000/tcp                                                                                                                                                                              │
 │    trustshield-minio      minio/minio:latest            "/usr/bin/docker-ent…"   minio             20 hours ago   Up 20 hours (healthy)                  0.0.0.0:9000-9001->9000-9001/tcp,          │
 │    [::]:9000-9001->9000-9001/tcp                                                                                                                                                                    │
 │    trustshield-mlflow     trustshield-mlflow            "mlflow server --hos…"   mlflow            20 hours ago   Up 20 hours                            0.0.0.0:5000->5000/tcp,                    │
 │    [::]:5000->5000/tcp                                                                                                                                                                              │
 │    trustshield-postgres   postgres:13.12                "docker-entrypoint.s…"   postgres          20 hours ago   Up 20 hours (healthy)                  0.0.0.0:5432->5432/tcp,                    │
 │    [::]:5432->5432/tcp                                                                                                                                                                              │
 │                                                                                                                                                                                                     │
 ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
